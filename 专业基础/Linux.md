**Linux**

# Linux简介


# Linux基础

## Linux目录结构

Linux目录结构为树型结构.  
Windows 系统可以拥有多个盘符, 如 C盘, D盘, E盘.  
Linux没有盘符这个概念, 只有一个根目录: "/", 所有文件都在它下面.  

- 路径描述:  
    - Linux系统中, 路径之间的层级关系, 使用 "/" 表示.  
    - Windows系统中, 路径之间的层级关系, 使用 "\\" 表示.  


## 用户

Linux 为多用户系统, 用户分为**根用户(系统管理员)** 和 **普通用户** 两大类.  
每个用户都有唯一的用户名, 用户名即为用户账号.  

根用户又称超级用户, 用户账号为 root.  
普通用户账号由根用户创建, 命名时不能以数字和下划线开头.  


## Linux命令行

- 命令行: 即Linux终端(Terminal), 或者说 Shell(壳), 是一种命令提示符界面. 以纯"字符"的形式来操作系统, 可以使用各种字符化命令对系统发出操作指令.  
- 命令: 即Linux程序. 命令没有图形化页面, 可以在命令行(终端)提供字符化的反馈.  

在 shell 中 $ 称为 shell提示符, ～ 表示主目录, 是登录时的默认目录.  

- 命令的通用格式:  `commandName [-options] [parameter]`  
	- commandName: 命令名, 区分大小写, 一般都是小写字母.  
    - -options: [可选]选项, 可以通过选项控制命令的行为细节.  
    - parameter: [可选]命令参数, 多用于命令的指向目标.  


### 基础命令

**ls命令: 列出目录下的内容**.  
`ls [-a -l -h] [路径]`  
- a: all, 列出全部文件, 包括隐藏的文件/文件夹. 以 "." 开头的文件(夹)为隐藏文件(夹).  
- l: list, 竖向排列展示内容, 并会展示一些文件信息.  
- h: 以易于阅读的形式列出文件大小(单位: b), 以 MB 替代 b.  
- 路径: 指定路径, 默认为当前工作目录.  

Linux命令行终端启动的默认目录为当前个人用户目录, 路径为: "/home/<用户名>"
多个并列选项可组合使用: `-al(-la)`

---

**cd命令: 更改当前工作目录**.  
`cd [路径]`  
- 默认为用户的home目录(不写路径参数).  

---

**pwd命令: 查看当前所在目录**.  
`pwd`

---

相对路径与绝对路径:  
- 相对路径: 以当前目录为起点, 无需以 "/" 开头.  
- 绝对路径: 以根目录为起点.  
- 特殊路径符:  
    - . : 表示当前目录, `cd ./Desktop`.  
    - .. : 表示上一级目录, `cd ..`.  
    - `~` : 表示home目录, `cd ~`.  

---

**mkdir命令: 创建新的文件夹**.  
`mkdir [-p] 路径`  
- 参数(路径)必填.  
- p: 自动创建不存在的父级目录, 用于创建多级目录(未选时, 如果创建的文件夹的父级目录不存在, 则无法创建).

- 创建文件夹需要修改权限, 在 HOME 外操作会涉及权限问题.  

---

**touch命令: 创建文件**.  
`touch 路径(包括文件名)`  
- 无选项, 参数必填
- 在 `ls -l` 查看时, 第一个信息以 "d" 开头表示文件夹, "-" 表示文件.  

---

**cat命令: 查看文件内容.**  
`cat 文件路径`  
**more命令**: 同样可以查看文件内容, cat 会将内容全部显示出来, more 支持翻页, 如果文件内容较多, 会自动分页.  
- 空格翻页.
- q 退出.

---

**cp(copy)命令: 复制文件夹**.  
`cp [-r] 参数1 参数2`  
- r: 用于复制文件夹, 表示递归.  
- 参数1: 路径, 表示被复制的文件(夹).  
- 参数2: 路径, 表示要复制到的位置.  

---

**mv(move)命令: 移动文件(夹)**.  
`mv 参数1 参数2`  
- 参数1: 被移动的文件(路径).  
- 参数2: 移动的目的地(路径). 如果附带文件名且名称与原文件名不一致会更改为此文件名.  

---

**rm(remove)命令: 删除文件(夹)**.  
`rm [-r -f] 参数1 参数2 ... 参数n`  
- r: 与cp一致, 用于删除文件夹.  
- f: 表示强制删除, 不会弹出提示确认信息.  
- 参数: 表示删除目标的路径.  

---

**which命令: 查看命令的程序文件存放位置**.  
`which <命令>`  
- 如: `which cd`.  

---

**find命令: 按文件名查找文件**.  
`find 起始路径 -name "文件名"`  
- 切换root用户以获得管理员权限, `su - root`, 再输入密码. 输入 `exit` 退出.   
- 支持通配符

按文件大小查找:  
`find 起始路径 -size +l -n [kMG]`  
- +, -: 表示大于和小于.  
- n: 表示文件大小.
- kMG: 单位, k(kb), M(MB), G(GB).  

`find / -size +1M`  
- CTRL+c: 强行停止.  

---

### 文件全局字符

在处理大量文件时, 使用 globbing 字符可以更加便捷.  
其可以与任何接受文件选项列表作为参数的命令一起使用.  
有 通配符(\*), 问号, 感叹号, 方括号, 破折号.  
全局字符可以 多次使用, 混合使用.  

其作用类似于 正则表达式.  

#### 通配符

\* 可以匹配任意长度的任意字符.  
例:  
```linux
cd /etc
echo *
echo pa*
echo *.d
```
> echo: 将参数打印至命令行
> echo \*: 显示包含任何字符的文件和目录


#### 其他字符

- 问号 `?`:  
	匹配一个任意字符.  

- 方括号 `[]`:  
	特定位置允许的字符范围.
	`sub[ug]id` : 以 sub 开头, 第四个字符为 u 或 g, 其后为 id.  

- 破折号 `-`:  
	一般配合 `[]` 表示范围.  
	`[a-z]` `[0-9]`  

- 感叹号 `!`:  
	配合 `[]` 表示不应该有的字符.  
	`[!123]` `[!2-6]`


#### 引用与转义

当使用 `* # [ ] . ~ ! $ { } < > | ? & - / , "` 以及空格 作为文件名或目录名时, 如果直接访问, 其特殊字符会被解释成特殊的含义而无法访问.  

- 引用:  
	将特殊字符放入 **单引号** 内, 其内容将不会被shell扩展.  
	大多数使用 双引号 也可以.  

- 转义:  
	在特殊字符前加反斜杠 "\\" 来将其视为普通字符.  


### 默认命令语法文档

很多 shell 命令的选项和参数非常复杂, 没人可以记住所有的命令.  
通过文档来了解命令是非常有必要的.  

**在 Linux 中描述命令用法的标准方式是命令名称，包含文本、点和文本的方括号**  
`CommandName [XXX]... TEXT`.  
**方括号表示中的内容是可选的。  
三个点意味着点前的表达式可以重复多次或只重复一次。  
任何不带方括号的单词都是强制性的。**  

如 ls 命令:  
`ls [OPTION]... [FILE]...`

- 获取帮助文档:  
	大部分命令都可以通过 `-h` 或 `-help` 获取帮助.  

- 可以用man命令打开命令手册:  
	如: copy命令的 'man cp'.  
	斜杠'/'后输入关键词用于搜索文本.  
	按'Esc'退出搜索, g回到顶部, G为底部, q退出手册.  


### 命令行快捷键

- 光标移到行尾: `Ctrl+E`.  
- 光标回到开头: `Ctrl+A`, 
- 移动到上/下一个'单词': `Ctrl+ <-`, `Ctrl+ ->`.  
- `Ctrl+X+X`.  
- 删除光标到命令行末尾的文本: `Ctrl+K`.  
- 删除光标到命令行开头的文本: `Ctrl+U`.  
- 删除到单词末尾: `Ctrl+D`.  


## 标准流

三个标准通道:  
- 标准输入(stdin).  
- 标准输出(stdout).  
- 标准误差(stderr).  

正常程序输出到 stdout 或 stderr(错误), 但也可以使用 **重定向** 使其输出到文件中.  
> `>`: 输出重定向.  
> `<`: 输入重定向.  

如: `ls /var/lib/systemd/ > /tmp/stdout-output.txt`.  
in, out, err 用 0, 1, 2 对应.  
上面的也可以写成: `ls /var/lib/systemd/ 1> /tmp/stdout-output.txt`.  

可以使用这些 shell管道 使一个命令的输出成为另一个命令的输入.  
- 管道符号: `|`.  
如: `cat name.txt | sort | uniq | wc`.  

`>` 会覆盖原内容, `>>` 为追加输入.  

## 正则表达式


正则表达式: ...  

- grep命令:  
	逐行遍历文本文件或输入流, 输出与搜索模式匹配的每一行.  
	`grep -i root /etc/services`: 返回文件有root的每一行; -i, 忽略大小写.  
	使用正则表达式时, 表达式应用单引号, `''`.  

- sed命令:  
	sed 通常用于将输出转换为所需的形式.  
	`cat /etc/services | sed '20, 50 d'`: sed会删除输出中的20到50行.  
	
	- 替换文本: `sed 's/[search_for_text]/[replace_with_text]/' filename`.  
	> search_for_text: 匹配模式, 可以是正则表达式或文字表达式, 会将其替换为 replace_with_text 的内容.  
	
	- 另一种形式: `sed 's:XX:YY:g' filename`.  

- awk命令:  
	awk可以创建规则和操作对, 且对匹配规则的每行进行操作.  
	规则(模式)可以使用正则, 操作可以类似 c语言.  
	
	语法: `awk [pattern] {action}... inputFile`.  



# vi\\vim编辑器

visual interface 的简称, 是Linux中经典的文本编辑器.  
vim 是 vi 的加强版.  

### 三种工作模式

- 命令模式:  
    所有输入都视为命令, 以命令驱动执行不同功能.  
    不能自由进行文本编辑.  

- 输入模式:  
    即编辑模式, 插入模式.  
    可以自由编辑.  

- 底线命令(命令行)模式:  
    以 ":" 开始, 通常用于文件的保存, 退出.  

<span style="color:blue">vim模式切换</span>:  
![vim模式切换](../../image/其他/vim模式切换.png)

<span style="color:blue">vim键盘图</span>
![vim键盘图](../../image/其他/vim键盘图.png)  

输入 `vi/vim <filename/路径>` 进入编辑器(命令模式), 文件不存在会自动创建.  
在命令模式以 ":" 开头的为单行的底线命令, 按 "Enter" 自动执行并退出.  

**命令模式的常用命令**:  
- 插入命令(进入编辑模式):
	按 'Esc' 退出.  

| 命令 | 作用                 |
|:----:| -------------------- |
|  a   | 在光标所在字符后插入 | 
|  A   | 在光标所在行尾插入   |
|  i   | 在光标所在字符前插入 |
|  I   | 在光标所在行首插入   |
|  o   | 在光标下插入新行     |
|  O   | 在光标上插入新行     |

1. 移动光标:  
	1. 上下左右移动光标:  
		h(左), j(下), k(上), l(右).  
		按下数字(即输入n), 再按hjkl, 可以移动n次.  
	1. 行首行尾:  
		`^`: 移动到行首. `$`: 移动到行尾.  
	3. 文件头尾:  
		`gg`: 文件头. `G`: 文件尾(shift + g).  
	4. 移动到指定行:  
		`:n`: 移动到第n行.  

2. 删除或剪切:  
	1. 删除字符:  
		`x`: 删除单个字符.  
		`[n]x`: 删除n个字符.  
	2. 删除/剪切整行:  
		- 删除的内容会放入剪切板.  
			`dd`: 删除单行.  
			`[n]dd`: 删除n行.  
			`:[n1][n2]d`: 删除指定范围的行.  
		- 粘贴:  
			`p`: 粘贴到光标下一行.  
			`P`: 粘贴到光标上一行.  

&nbsp;

3. 复制:  
	`yy`: 复制单行.  
	`[n]yy`: 复制n行.  
<br>
4. 撤销:  
	`u`: 撤销.  
	`Ctrl + u`: 反撤销.  
<br>
5. 替换:  
	`r`: 替换光标位置的字符.  
	`R`: 从光标位置开始替换字符, 按'Esc'结束.  
<br>
6. 选中文本:  
	`v`: 开始或结束选中, 选择字符.  
	`V(shift+v)`: 开始或..., 选择行.  
	`Ctrl+v`: ..., 选择矩形区域.  
<br>
7. t: 
	`命令 t 字符`.  
	如: `d t .`, 按序按下这三个键会一直删到'.'之前.  
<br>
8. 宏:  
	宏即一段可以重复执行的操作.  
	开始录制: `q {register}`, register(寄存器, a-z?).  
	再次按下 q, 结束录制.  
	
	执行: `[n]@(shift+2) {register}`, n为执行次数, 默认为1次.  
	按行执行: `:n, m normal @{register}`.  
	
	查看宏: `:reg [register]`.  

**末行模式命令**:  

| 命令 | 作用         |
|:----:| ------------ |
|  :w  | 保存         |
|  :q  | 退出         |
| :wq  | 保存退出     |
|  :!  | 强制         |
| :q!  | 强制退出     |
| :wq! | 强制保存退出 | 

1. 设置(临时):  
	`:set nu/nonu`: 显示与取消行号.  
	`:syntax on/off`: 是否根据语法显示相关颜色帮助, 默认为 on.  
	`:set (no)hlsearch`: 是否将搜索到的字符串高亮显示, 默认高亮.  
	`:set (no)showmode`: 设置是否在左下角显示模式状态(如 '-INSERT-').  
	`:set (no)list`: 是否显示隐藏字符(tab键用 "^|", 回车(Enter)用 "$").  

2. 查找:  
	`/[内容]`: 从光标所在行向下查找.  
	`?[内容]`: 从光标所在行向下查找.  
	`n`: 下一个.  
	`N`: 上一个.

3. 替换(Substitute命令):  
	格式: `:[range] s/search/replace/[flags] [count]`.  
	- \[range]: 范围, \[n,m], 未指定默认则为当前行.  
	- \[flags]: 默认为替换第一个匹配的字符串, 想全部替换可以使用 g(global)标记.  
		- p(print), 打印所做的改动.  
		- c(confirm), 在改动前先询问.  
		- i(ignorecase), 忽略大小写.  
	`:1, 10 s/old/new/g`: 替换1到10行所有'old'为'new'.  
	`:% s/...`: %代表整个文档.  

4. 调用外部命令:  
	`:![命令]`

5. 插入文件内容:  
	`:r file`: 从指定文件读取内容, 插入在当前行.  
	示例:  
	`:0r ! head -n 2 /etc/passwd`: 0, 在上方插入, ! 后为命令(读取passwd的前两行).  

# 文件系统


## 文件系统简介

Linux最经典的一句话是"一切皆文件". 块设备, 管道, socket等都由文件系统管理.  
任何linux发行版上的根目录结构都相同(`tree -d -L 1 /`), 它们都遵守 文件系统层次标准(FHS).  

- `/`: 斜线是主层级根.  
- `/bin`: 包含系统所需的基本命令.  
- `boot`: 包含引导所需的文件, 如内核文件. 
- `/dev`: 包含系统的设备文件, 包含系统上安装的所有应用的系统范围配置文件.  
- `/home`: 包含用户的主目录.  
- `/lib`: 包含"/bin"和"/sbin"中 二进制文件所必须的库.  
- `/media`: 包含光盘等可移动介质的挂载点.  
- `/mnt`: 包含临时安装的文件系统.  
- `/opt`: 包含可选的应用软件包.  
- `/proc`: 包含虚拟文件系统, 提供进程和内核信息作为文件.  
- `/root`: 包含'root'用户的主目录.  
- `/run`: 包含运行时变量数据.  
- `/sbin`: 包含必要的系统二进制文件.  
- `/srv`: 包含系统应该服务的所有数据.  
- `/sys`: 包含连接到系统的设备的信息.  
- `/tmp`: 包含临时文件.  
- `/usr`: 包含了大部分所有的用户实用程序和应用.  
- `/var`: 包含预期会不断变化的所有.  

Linux 系统中的每个用户在文件系统中都有自己的私有位置, 在那里他们可以管理自己的数据, 并拥有对所有内容的完全访问权.  
出于安全原因, 除了少数例外, linux文件系统的大多数地方都有很多限制, 只有 'root'用户拥有对所有内容的完全访问权限.  

Linux文件对大小写敏感, 以'.'开头的文件为隐藏文件.  
Linux文件的扩展名可以是任意长度的字符, 但只是给用户看的, 对系统没有实际意义.  

- 有关文件的命令:  
	`ls`, 列出文件(夹); `touch`, 创建文件; `mkdir`, 创建目录; `rmdir`, 删除空目录; `rm`, 删除文件; `cp`, 复制文件; 

- `ls -l`:  
	列表的第一个字符是 'd, -, l' 中的一个, 代表文件类型.  
	> d, 目录; -, 普通文件; l, 链接.  
	
	其后为相关的权限.  
	数字为文件的链接数.  

## 文件链接

链接是在共享文件和访问它的用户的若干目录项之间建立联系的一种方式.  

- 硬链接:  
	通过索引节点来进行链接.  
	每个文件都会分配一个索引节点(Index). 文件属性保存在节点中, 通过索引节点定位文件, 可以让多个文件名指向同一索引节点.  

	- 不允许给目录创建硬链接.  
	- 只有在同一文件系统(同一分区)中的文件之间才能创建硬链接.  

- 符号链接:  
	又称软链接,软链接文件包含另一个文件的路径名.  
	当需要在不同目录使用相同的文件时, 可以将其放在一个固定的目录, 其他目录下使用软链接.  

	- 当源文件移动时, 所有相关的软链接都会失效.  


- ln命令: `ln [option]... 源文件或目录 目标文件或目录`  
	ln命令用来链接文件或目录.  
	- option: `-s`: 创建符号链接, 不选默认为硬链接.  
	目标文件或目录没有给出时创建同名的链接.  


## 用户与组


每个Linux用户都由唯一的用户标识来定义和识别, 但当管理文件等Linux对象时, 使用用户标识号(UID).  
如果使用用户名来控制对文件的访问, 那么授予或撤销权限将非常麻烦. 可以将共享资源的权限赋予一个组, 将用户加入或退出组来进行授权.  
Linux组有其组标和组名, 用户可以属于多个组.  

- 添加/删除用户:  
	`useradd username`: root用户下, 用给定的参数作为用户名创建一个新用户.  
	还需要为其设置密码: `passwd 'username'`, 之后输入两次密码即可.  
	`userdel username`: 删除用户, 其不会删除用户的'home'目录, 要自己手动删除, 或加上 `-r`.  

- 组的创建与删除:  
	创建新组: `groupadd groupname`.  
	删除组: `groupdel groupname`.  
	修改组: `groupmode -n name newname`.  
	将用户加入/退出组: `gpasswd -a/d username groupname`.  


## 文件权限

`ls -l`命令中第一个字符为文件类型, 其后的9个字符表示其权限.  
前三个为**文件所有者**的权限, 中间三个为**组所有者**的权限, 最后三个为**其他用户**的权限.  
r: 读; w: 写; x: 执行; -: 无对应权限.  

- 更改权限:  
	可以使用`chown`或`chgrp`更改文件所有权或组所有权.  
	- `chmod [who] [opt] [mode] 文件或目录名`:  
		who: u(文件所有者), g(同组用户), o(其他用户), a(所有用户). 可以组合使用.  
		opt: +(添加权限), -(取消权限), =(赋予给定权限, 取消原有权限).  
		mode: rwx, 可以用二进制数表示, 如7(111), 5(101). 权限用9个字母(三组)表示, 所以一般用三个0-7的数字表示, 如755.  
	
	- `chown owner file/dir`:  
		将文件或命令的所有者改为owner.  
		-R: 递归修改, 子目录也会一同修改.  
	








# 系统管理


## 系统的运行


### 系统启动


Linux系统启动过程是指从计算机打开电源开始到显示用户登录界面的整个过程.  

1. 加载BIOS:  
	先进行加电自检, 然后读入主引导记录(MBR).  
	BIOS信息中包含CPU相关信息, 设备启动顺序, 硬盘信息, 内存信息, 时钟信息等.  

2. 加载 Boot Loader:  
	Boot Loader是内核运行之前运行的一段小程序.  
	其可以初始化硬件设备, 建立内存空间的映射.  
	常见的Loader有GRUB, LILO.  

3. 加载内核映像:  
	根据GRUB设定的路径, 系统读取内存映像, 进行解压缩. 调用 start_kernel() 来启动一系列的初始化函数, 完成Linux核心环境的建立.  

4. 执行 init 进程:  
	查看/etc/inittab, 确定运行级别.  
	加载此级别的所有服务程序.  

5. 进入登录状态:  
	执行/bin/login程序, 建立登录接口.  


### 系统运行级别


**7种运行级别**:  

- 运行级别 0:  
	系统停机状态, 系统默认运行级别不能设为0, 否则无法正常启动.  

- 运行级别 1:  
	单用户工作状态, root权限, 用于系统维护, 禁止远程登录.  

- 运行级别 2:  
	多用户状态(没有NFS支持).  

- 运行级别 3:  
	完全的多用户状态, 标准运行级别, 登录后进入命令行模式.  

- 运行级别 4:  
	系统未使用, 保留.  

- 运行级别 5:  
	多用户模式, X11控制台, 登录后进入GUI模式.  

- 运行级别 6:  
	系统正常关闭并重启, 默认运行级别不能设为6, 否则无法正常启动.  


**运行级别配置**:  

默认运行级别由 /etc/inittab 中的 "id..." 条目确定.  
- 格式:  
	`id:runleves:action:process`  
	- id: 唯一标识符, 与登录终端tty编号一致.  
	- runleve: 运行级别.  
	- action: 行为, initdefault, 默认运行级别.  
	- process: 指明应执行的程序, action设为initdefault时会执行对应的程序, 该字段无意义.  

将runleve修改为指定级别即可.  


**运行级别切换**:  

- 查看当前运行级别:  
	`runleve`  
- 进入其他运行级别:  
	`init N`  


### 系统关闭



## 用户管理




## 设备管理


Linux 中的设备也是由文件表示.  
设备分为 **字符设备**, **块设备**, **网络设备**.  

- 字符设备:  
	数据组织单位为字节, 



## 进程管理


