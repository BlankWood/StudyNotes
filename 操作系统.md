**操作系统**  
《计算机操作系统(第四版)》  
[王道计算机考研-操作系统](https://www.bilibili.com/video/BV1YE411D7nH)  

常见的操作系统有:  
- 电脑: Windows, Linux, Mac OS.
- 手机: Android(安卓), iOS(苹果).

# 引论

操作系统(operating system, os)是配置在计算机硬件上的第一层软件(属于系统软件), 用来控制和管理整个计算机系统的硬件和软件资源, 并为用户和应用程序提供一个简单的接口和环境.

## 操作系统的功能和目标

1. 作为用户与计算机硬件系统之间的接口 - 方便用户使用  
    - 命令接口: 允许用户直接使用
    - 程序接口: 允许用户通过程序间接使用
    - GUI: 现代操作系统中最流行的图形用户接口


2. 作为系统资源的管理者 - 安全, 高效  
    - 处理机管理
    - 储存器管理
    - 文件管理
    - 设备管理

3. 实现对计算机资源的抽象
    为了方便用户使用I/O设备, 在裸机上安装操作系统, 实现对I/O设备的操作细节, 从而用户无需关心I/O是如何具体实现的.  
    通常把覆盖了这样的软件的机器称为扩充机器或虚拟机.

具体的功能分类:  
1. 处理机管理(进程控制, 进程同步, 进程通信, 调度)
2. 存储器管理(内存分配, 内存保护, 地址映射, 内存扩充)
3. 设备管理(缓冲管理, 设备分配, 设备处理)
4. 文件管理(文件存储空间的管理, 目录管理, 文件的读写管理和保护)
5. 用户接口(用户接口, 程序接口)

现代操作系统的新功能:  
1. 系统安全
2. 网络的功能和服务
3. 支持多媒体

## 操作系统的基本特征

1. 并发  
    并发指两个或多个事件在同一时间间隔内发生. 这些事件宏观上是同时发生的, 但微观上是交替发生的.  
    并行: 指两个或多个事件在同一时刻发生.  

2. 共享  
    - 互斥共享方式: 系统中的某些资源, 如打印机、磁带机等, 虽然可以提供给多个进程使用, 但在一段时间内只允许一个进程访问该资源.  
    - 同时共享方式: 系统中的某些资源, 允许在一段时间内由多个进程"同时"访问.

如果失去并发性, 则共享性失去意义.  
如果失去共享性, 就难以实现并发.  
并发和共享是多用户(多任务)OS的两个最基本的特征, 它们互为存在条件.  

3. 虚拟  
    在OS中, 把通过某种技术将一个物理实体变为若干个逻辑上的对应物的功能称为"虚拟".  
    - 时分复用技术: 提高设备对空闲时间的利用.  
    - 空分复用技术: 提高存储空间的利用率.

4. 异步  
    指在多道程序环境下, 系统允许多个进程并发执行, 但由于资源有限, 进程的执行并不是一贯到底的, 而是"走走停停", 以不可预知的速度进行.  

## 操作系统发展与分类

1. 手工操作方式  
    用穿孔的纸带或卡片进行输入.  
    缺点: 用户独占全机, 人工装卸时CPU等资源处于空闲状态.

2. 单道批处理系统  
    利用外围机事先将程序与数据录入磁带中, 再高速调入内存.  
    在一定程度上缓解了人机速度矛盾, 但CPU仍有大量时间是在等待I/O完成.  

3. 多道批处理系统  
    多道程序并发执行, 共享计算机资源. 资源的利用率大幅提升, CPU和其他资源保持"忙碌"状态, 系统吞吐量大.  
    但是用户的响应时间长, 且没有人机交互能力(在程序运行时, 不能与自己的作业进行交互)

4. 分时操作系统  
    计算机以时间片(如30ms)为单位轮流为各个用户/作业服务, 各个用户可通过终端与计算机进行交互.  
    主要根据人们所能接受的等待时间决定响应时间(1~3s).
    主要优点: 解决了人机交互问题. 允许多个用户同时使用一台计算机, 并且操作互相独立.  
    主要缺点: 不能优先处理一些紧急任务.

5. 实时操作系统  
    能优先响应一些紧急任务, 不需要时间片排队.  
    在实时操作系统的控制下, 计算机系统接收到外部信号后及时进行处理, 并且要在严格的时限内处理完事件. 主要的特点是**及时性和可靠性**.  
    根据严格程度分为 **硬实时系统**与**软实时系统**.  
    响应时间由控制对象所要求的截至时间来确定(毫秒级).  

6. 其他操作系统  
    - 网络操作系统
    - 分布式操作系统
    - 个人计算机操作系统

## os的运行机制与体系结构

### 运行机制

指令: 处理器(CPU)能识别, 执行的最基础命令.  
    - 特权指令(不允许用户程序使用): 如内存清零指令  
    - 非特权指令: 如普通的运算指令  

两种处理器状态:  
    - 用户态(目态): CPU只能执行非特权指令  
    - 核心态(管态): 可执行所有指令  

两种程序:  
    - 核心程序: 操作系统的内核程序是系统的管理者, 运行在核心态.  
    - 应用程序: 普通应用程序只能执行非特权指令, 运行在用户态.  

内核是计算机上配置的底层软件, 是操作系统最基本、最核心的部分。  
实现操作系统内核功能的那些程序就是内核程序。  
不同的操作系统对内核功能的划分可能并不一样。

### 体系结构

- 大内核: 将操作系统的主要功能模块都作为系统的内核, 运行在核心态.  
    - 优点: 高性能
    - 缺点: 内核代码庞大, 结构混乱, 难维护

- 微内核: 只把最基本的功能保留在内核.  
    - 优点: 内核功能少, 结构清晰, 方便维护
    - 缺点: 需要频繁地在核心态和用户态之间切换, 性能低


## 中断和异常

### 中断机制的诞生

中断机制是为了实现进程的并发.  
本质: 发生中断就意味着**需要操作系统介入,开展管理工作**.


- 当CPU收到计时部件发出的中断信号(每过一个时间片), 会切换到核心态对中断进行处理, 进行进程的切换.  
- 当进程发出**系统调用**时(内中断信号), CPU切换为核心态, 对中断进行处理.  
- 当I/O完成时, 设备会向CPU发出中断信号, CPU进行处理...


1. 当中断发生时,CPU立即进入核心态.★
2. 当中断发生后, 当前进程暂停, 并由操作系统内核对中断进行处理.
3. 对于不同的中断信号, 会进行不同的处理.

中断是从用户态转换为核心态的唯一途径.★  
从核心态转换为用户态是通过执行一个特权指令, 将程序状态字(PSW)的标志位设置为"用户态".  

### 中断的分类★

中断分为**内中断**和**外中断**, 外中断为狭义的中断.  
**内中断的信号来自CPU内部**, 与当前执行的程序有关; **外中断来自CPU外部**, 与当前执行的程序无关.  

内中断(也称异常、例外、陷入), 可分为自愿中断(指令中断)与强迫中断, 强迫中断分为硬件故障与软件中断.  
外中断分为外设请求和人工干预.  

### 外中断的处理过程

1. 执行完每个指令后, CPU都要检查当前是否有外部中断信号.
2. 检查到外部中断信号时, 需要保护被中断进程的CPU环境.
3. 根据中断信号类型转入相应的中断处理程序.
4. 恢复原进程的CPU环境并退出中断, 返回原进程继续往下执行.


## 系统调用

操作系统作为用户和计算机硬件之间的接口, 需要向上提供一些简单易用的服务. 主要包括命令接口和程序接口. 其中, 程序接口就是由一组系统调用组成.  

"系统调用" 是操作系统提供给应用程序(程序员/编程人员)使用的接口, 可以理解为一种可供应用程序调用的特殊函数, 应用程序可以发出系统调用请求来获得操作系统的服务.

### 系统调用的作用

应用程序提供系统调用请求操作系统的服务.  
系统中的各种共享资源都由操作系统统一管理, 因此在用户程序中, 凡是与资源有关的操作(如存储分配、I/O操作、文件管理等), 都必须提供系统调用的方式向操作系统提出服务请求, 由操作系统代为完成.  
这样可以保证系统的稳定性和安全性, 防止用户进行非法操作.  


- 系统调用会使处理器从用户态进入核心态.
- 一些高级语言(如C++)也是通过封装系统调用来操作系统资源.


