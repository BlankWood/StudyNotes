
# 计算机系统概论

## 1.1 冯·诺伊曼计算机的特点

- 计算机由运算器、存储器、控制器、输入输出设备五大部件组成.
- 指令和数据以同等地位存放于存储器内, 并可按地址寻访.
- 指令和数据均用二进制数表示.
- 指令由操作码和地址码组成, 操作码用来表示操作的性质, 地址码用来表示操作数在存储器中的位置.
- 指令在存储器内按顺序存放. 通常, 指令是顺序执行的.
- 机器以运算器为中心, 输入输出设备与存储器间的数据传送通过运算器完成.  

典型的冯·诺伊曼计算机是以运算器为中心的. 现代的计算机已转化为以存储器为中心. 


## 1.2 计算机的工作步骤

### 1.2.1 计算机组成



计算机分为**主机**和**外设**.  
主机由**主存储器**和**CPU**组成, CPU内有**运算器**和**控制器**.  

- 主存储器(简称主存或内存):  
    包括存储体M、各种逻辑部件及控制电路等.  
    主存的工作方式就是按存储单元的地址号来实现对存储字各位的存(写入)、取(读出).  
    为实现按地址访问(访存)的方式, 需要配置两个寄存器MAR和MDR.  

- MAR(Memory Address Register):  
    存储器地址寄存器, 用来存放欲访问的存储单元的地址.  
    其位数对应存储单元的个数, 2^N(N位), 1K = 2^10.  

- MDR(Memory Data Register):  
    存储器数据寄存器, 用来存放需要存取的数据.  
    其数位与存储字长相等. 字长即存储单元的位数, 8位, 16位, 32位等.  

随着硬件技术的发展, 主存都制成大规模集成电路的芯片, 而将MAR和MDR集成在CPU芯片中.  

- 运算器:  
    运算器最少包括3个寄存器(现代计算机内部往往设有通用寄存器组)和一个算术逻辑单元(ALU).  
    ACC(累加器), MQ(乘商寄存器), X(操作数寄存器).  

- 控制器:  
    控制器是计算机的神经枢纽, 由它指挥各部件自动、协调地工作.  
    完成一条指令分为**取指、分析、执行**3个阶段.  
    控制器由程序计数器(PC)、指令寄存器(IR)、控制单元(CU)组成.  
    PC, 用来存放当前欲执行指令的地址, 与主存的MAR间有直接通路, 且有自动加 1 的功能, 即可自动形成下一条指令的地址.  
    IR, 用来存放当前的指令(来自MDR). IR中的操作码(OP(IR))送至CU, 记为OP(IR) -> CU, 用来分析指令. IR中的地址码(Ad(IR))送至MAR, 记作 Ad(IR) -> MAR.  
    CU, 用来分析当前指令所需完成的操作, 并发出命令序列.  

- I/O:  
    I/O子系统包括各种I/O设备及其相应的接口. 每一种I/O设备都由I/O接口与主机联系. 它接收CU发出的各种控制命令, 并完成相应的操作.  
    如键盘, 打印机等.  

### 1.2.2 过程

取指:  
将 PC 的内容送至主存的 MAR,    (PC -> MAR)  
根据地址将存储器的内容读入 MDR, 然后送至控制器的 IR,  (MDR -> IR)  

分析:  
将 MDR 的指令的操作码送至 CU 分析,     (OP(IR) -> CU)  

执行:  
- 如果是取数, 则 CU 会将地址码送至 MAR 进行取数放入MDR,    (Ad(IR) -> MAR)  
    然后再放入运算器的ACC,  (MDR -> ACC)  
- ...

PC会自动加 1, 形成下一条指令的地址.  (PC) + 1 -> PC

    
## 1.3 计算机硬件的主要技术指标

- 机器字长:  
    机器字长是指 CPU 一次能处理的数据的位数, 通常与 CPU 的寄存器位数有关.  

- 存储容量:  
    存储器的容量应该包括**主存容量**和**辅存容量**.  
    存储容量 = 存储单元的个数 X 存储字长.  
    现代计算机常以字节数来描述容量的大小, 1字节 为 8位 二进制代码(1B = 8 bit).  
    1K = 2^10, 1M = 2^20, 1G = 2^30.  

- 运算速度:  
    计算机的运算速度与许多因素有关, 机器的主频, 程序的不同, 主存本身的速度等.  
    现在机器的运算速度普遍采用单位时间内执行指令的平均条数来衡量, 并用 MIPS(百万条指令每秒) 作为单位.  
    其他单位: CPI(执行一条指令所需的时钟周期, 机器主频的倒数), FLOPS(浮点运算次数每秒).  



# 系统总线

计算机的五大部件之间的互连方式有两种: 各部件之间单独连线(分散连接), 各部件连到一组公共信息传输线上(总线连接).  

总线是连接多个部件的信息传输线, 是各部件共享的传输介质.  
当多个部件与总线相连时, 如果出现多个部件同时向总线发生信息, 势必导致信号冲突, 传输无效.  
因此, 在某一时刻, 只允许有一个部件向总线发送信息, 而多个部件可以同时从总线上接收相同的信息.  


## 2.1 总线分类

按连接部件的不同, 介绍三类总线.  

- 片内总线:  
    片内总线是指芯片内部的总线, 如在CPU芯片内部, 寄存器与寄存器之间, 寄存器与算逻单元ALU之间都由片内总线连接.  

- 系统总线:  
    系统总线是指 CPU, 主存, I/O设备各大部件之间的信息传输线.  
    由于这些部件通常都安放在主板或各个插件板(插卡)上, 故又称板级总线或板间总线.  
    按系统总线传输信息的不同, 又可分三类: **数据总线**, **地址总线**, **控制总线**.  

- 通信总线:  
    这类总线用于计算机系统之间或计算机系统与其他系统(如控制仪表, 移动通信等)之间的通信.  
    按传输方式可分为两种: 串行通信, 并行通信.  


## 2.2 总线性能指标

- 总线宽度:  
    通常是指数据总线的根数, 用 bit(位) 表示.

- 总线带宽:  
    总线的传输速率, 单位: MBps(兆字节每秒).  
    总线带宽 = 总线工作频率(MHz) X 总线宽度(bit或B).  

- ...  


## 2.3 总线结构

### 2.3.1 单总线结构

将 CPU, 主存, I/O设备(通过I/O接口)都挂在一组总线上, 允许I/O设备之间, I/O设备与CPU之间, I/O设备与主存之间直接交换信息.  
这种结构简单, 也便于扩充, 但所有的传送都通过这组共享总线, 极易形成计算机系统的瓶颈. 不允许多个设备同时向总线传输信息, 必然会影响效率.  
这类总线多被小型计算机或微型机采用.  

### 2.3.2 多总线结构

双总线结构的特点是将速度较低的I/O设备从单总线上分离出来, 形成主存总线与I/O总线分开的结构.  
如果将速率不同的I/O设备进行分类, 然后将它们连接在不同的通道上, 效率将会更高, 由此发展成多总线结构.  


## 2.4 总线控制

由于总线上连接着多个部件, 各部件的传输等问题需要总线控制统一管理.  
它主要包括 **判优控制(或称仲裁逻辑)** 和 **通信控制**.  

### 2.4.1 总线判优控制

总线上连接的所有设备, 按其对总线有无控制功能可分为主设备(模块)和从设备(模块)两种.  

当多个主设备同时要使用总线, 就由总线控制器的判优, 仲裁逻辑按一定的优先等级顺序确定哪个主设备能使用总线.  

总线判优控制可分为**集中式**和**分布式**两种.  
集中式: 将控制逻辑集中在一处(如CPU).  
分布式: 将控制逻辑分散在与总线相连的各个部件或设备上.  

常见的**集中控制**优先仲裁方式有以下三种:  

- 链式查询:  
    - 控制总线中有3根线用于总线控制(BS总线忙, BR总线请求, BG总线同意).  
    - BG串行地从一个I/O接口到下一个I/O接口. 如果BG到达的接口有总线请求, BG信号就不再下传, 该接口获得总线总线使用权, 并建立总线忙BS信号, 表示它占用了总线.  
    - 特点: 只需几根线就能按一定优先次序实现总线控制, 并且很容易扩充设备, 但对电路故障很敏感, 且优先级别低的设备很难获得请求.  

- 计数器定时查询:  
    - 与链式查询相比, 多了一组设备地址线, 少了根总线同意线BG.  
    - 总线控制部件接到由 BR 送来的信号后, 在总线未被使用的情况下, 总线控制部件中的计数器开始计数, 并通过设备地址线向各设备发出一组地址信号.  
    当某个请求占用总线的设备地址与计数值一致时, 便获得总线使用权, 此时终止计数查询.  
    - 特点: 设备的优先顺序即设备地址的顺序; 计数也可以从上次终止位置开始, 即循环计数, 此时设备的优先级相等; 计数的初始值还可以由程序设置.

- 独立请求方式:  
    - 每一台设备均有一对总线请求线和总线同意线.  
    - 总线控制部件会按一定优先次序确定响应哪台设备的请求.  
    - 特点: 响应速度快, 优先次序灵活, 但控制线数量多, 总线控制更复杂.  

### 2.4.2 总线通信控制

通常将完成一次总线操作的时间称为总线周期, 可分为4个阶段:  

- 申请分配阶段: 由需要使用总线的主设备(模块)提出申请, 经总线仲裁机构决定下一传输周期的总线使用权授予某一申请者.  
- 寻址阶段: 取得使用权的主模块(设备)通过总线发出本次要访问的从模块(设备)的地址及相关命令, 启动参与本次传输的从模块(设备).  
- 传输阶段: 主模块和从模块进行数据交换.  
- 结束阶段: 从系统总线上撤除主模块的有关信息, 让出总线使用权.  

总线通信控制主要解决通信双方如何获知传输开始和结束, 以及通信双方如何协调配合.  
通常用四种方式: 同步通信, 异步通信, 半同步通信, 分离式通信.  


#### 同步通信

由统一时钟控制数据传送.  
时标通常由CPU的总线控制部件发出, 送到总线上的所有部件; 如果是各部件时序发生器发出, 需要由总线控制部件进行同步.  

包含4个时钟周期: T1, T2, T3, T4.  

| 时钟周期\读写命令 | 读命令 | 写命令 |
| ---  | ----- | ------ |
| T1   | 主模块发地址   | 主模块发地址 |
| T1.5 |               | 主模块提供数据 |
| T2   | 主模块发读命令 | 主模块发写命令, 从模块接到后将数据及时写入指定的地址单元 |
| T3   | 从模块提供数据 |  |
| T4   | 主模块撤销读命令, 从模块撤销数据 | 主模块撤销写命令和数据等信号 |

优点: 规定明确, 统一, 模块间的配合简单一致.  
缺点: 强制性"同步", 必须在限定的时间内完成规定的要求. 且对所有从模块都用同一限时(按最慢的部件设计时钟), 势必影响效率. 

同步通信一般用于总线长度较短, 各部件存取时间比较一致的场合.  


#### 异步通信

允许各模块的速度不一致.  
没有公共的时钟标准, 采用应答方式(又称握手方式).  

- 不互锁方式:  
    主模块发出请求信号后, 不必等待接到从模块的回答信号, 经过一段时间撤销其请求信号.  
    从模块接到请求信号后, ...  

- 半互锁方式:  
    主模块发出请求信号, 必须待接到从模块的回答信号后再撤销其请求信号.  
    从模块发出回答信号后不必等待请求信号撤销, 一段时间后自动撤销回答信号.  

- 全互锁方式:  
    ...  
    
异步通信可用于并行传送或串行传送.  

异步串行通信需要统一字符格式:  
1个起始位(低电平), 5~8个数据位, 1个奇偶校验位(检错用), 1或1.5或2个终止位(高电平).  
**传送时数据的二进制顺序是反向的**, 起始位后是字符的最低位.  
起始位至终止位结束构成一帧, 两帧之间的间隔可以是任意长度的.  
传送速率以**波特率**来衡量: 单位时间内传送的二进制位数(单位: bps).  


#### 半同步通信

在保留同步通信的基础上, 增加一条"等待($\overline{wait}$)"响应信号线, 采用插入时钟(等待)周期的措施来协调通信双方的配合问题.  
当模块工作较慢, 时间不够时就给出一个等待信号, 增加一个时钟周期(等待周期), 不够继续加.  

半同步通信适用于系统工作速度不高但又包含由许多工作速度差异较大的个类设备组成的简单系统.  
半同步的控制方式比异步简单, 在全系统内各模块又在统一的系统时钟控制下同步工作, 可靠性较高, 同步结构较方便.  
其缺点是对系统时钟频率不能要求太高, 故从整体上看, 系统工作的速度仍不是很高.  

#### 分离式通信

将一个传输周期(总线周期)分解为两个子周期.  
在第一个子周期中, 主模块在获得总线使用权后将命令、地址以及其他信息, 包括该主模块编号发到系统总线上, 给从模块接收. 发完之后立即释放使用权.  
在第二个子周期中, 从模块接收后准备回复的信息, 由从模块申请总线使用权, 进行同样的发送方式.  

这种方式控制比较复杂, 一般在普通微型计算机系统很少采用.  

# 存储器

## 3.1 概述

### 3.1.1 存储器分类

---

按存储介质分类:  

- 半导体存储器:  
    现代半导体存储器都用超大规模集成电路工艺制成芯片.  
    优点: 体积小, 功耗低, 存取时间短.  
    缺点: 当电源消失时, 所存信息也随即消失. 近年研制的非挥发性材料制成的存储器克服了信息易失的弊病.  
    
- 磁表面存储器:  
    在金属或塑料基体的表面上涂一层磁性材料作为记录介质. 用具有矩形磁滞回线特性的材料作磁表面物质, 按其剩磁状态的不同区分"0"或"1". 剩磁状态不易丢失, 这类存储器有非易失性的特点.  

- 磁芯存储器:  
    磁芯是由硬磁材料制作的环状元件. 在磁芯中穿有驱动线(通电流)和读出线, 进行读写操作.  
    逐渐被半导体存储器取代.  

- 光盘存储器:  
    应用激光在介质(磁光材料)上进行读写, 非易失.  
    由于光盘记录密度高, 耐用性好, 可靠性高, 可互换性强等特点, 其越来越被用于计算机系统.  

---

按存取方式分:  

- 随机存储器(RAM):  
    特点是存储器的任何一个存储单元的内容都可以随机存取, 而且存取时间于存储单元的物理位置无关.  
    计算机系统中的主存都采用都采用这种随机存储器.  
    由存储信息的原理不同, 又分为**静态RAM(触发器)**和**动态RAM(电容)**.  

- 只读存储器(ROM):  
    只读不写, 通常存放固定不变的程序、常数和汉字字库, 甚至用于操作系统的固化.  
    随着发展派生出: 可编程只读存储器, 可擦除可编程只读存储器, 电擦除可编程只读存储器, 闪速存储器.  

- 串行访问存储器:
    按存储单元的物理位置的先后顺序寻找地址, 如磁带.  
    还有一种属于部分串行访问的存储器, 如磁盘.   


### 3.1.2 存储器的层次结构

存储器有3个主要性能指标: 速度、容量、每位价格(位价).  
一般速度越高, 位价越高; 容量越大, 位价越低; 容量越大, 速度越低.  

层次:  寄存器 - 缓存 - 主存 - 磁盘 - 磁带  

寄存器通常在CPU内部, 有十几, 几十个.  
CPU, 缓存, 主存之间能直接交换信息.  
磁盘, 磁带都属于辅存. 辅存能与主存交换信息.  


## 3.2 主存储器

概述:  

[计算机组成](#121-计算机组成)

CPU读取数据时, CPU先将其地址送到MAR, 经地址总线送至主存, 然后发出读命令.  
主存接到读命令后, 读出数据, 由数据总线送至MDR.  
写数据与读类似.  

- 存储单元的地址分配:  
    通常计算机系统既可按字寻址, 也可按字节寻址. 一个字由几个字节组成.  

    - 字地址用该字高位字节的地址表示(一字四字节):  
        | 字地址 | 字节地址 |
        | ------ | ------- |
        | 0 | 0 \| 1 \| 2 \| 3 |
        | 4 | 4 \| 5 \| 6 \| 7 |
        | 8 | 8 \| 9 \| 10 \| 11 |

    - 字地址用其低位字节的地址表示(一字两字节):  
        | 字地址 | 字节地址 |
        | ----- | -------- |
        | 0 | 1 \| 0 |
        | 2 | 3 \| 2 |
        | 4 | 5 \| 4 |


- 主存的技术指标:  
    - 存储容量:  
        存储容量 = 存储单元个数 x 存储字长 / 8 (字节)  
    - 存储速度:  
        **存取周期**, 指存储器进行连续两次独立的存储器操作所需的最小间隔时间.  (10 ns ~ 100 ns)


半导体存储芯片简介:  

存储芯片通过地址总线, 数据总线, 控制总线与外部连接.  
控制线主要有读写控制线与片选线两种. 存储器由多片芯片组成, 所以有片选确定是哪个芯片.  

### 3.2.1 随机存储器

- 静态RAM  
    用触发器存储信息，断电时数据会丢失.  
- 动态RAM  
    用电容存储信息，电容上的电荷一般只能维持 1 ~ 2 ms，即使不断电也会自动消失，所以需要刷新.  

- 动态RAM的刷新  
    先读出，再重新写入.  
    一般刷新周期为2ms.  
    - 集中刷新  
        在一个刷新周期内集中一段时间逐行刷新，此时必须停止读写操作.  这段时间称为 死时间 ，或访存 死区.  
    - 分散刷新  
        将每行的刷新分散到每个存取周期内. 存取周期翻倍，前半段用来读写或维持信息，后半段用来刷新。  
        这样不存在死时间，但是存取周期长了，整个系统速度降低.  
    - 异步刷新  
        存取周期不变，将每行的刷新平均分部在2ms内，如有128行，则15.6μs 刷新一行.  
        如果将刷新安排在CPU对指令的译码阶段，由于此时不会访问存储器，可以方便刷新.  

- 动态RAM与静态RAM的比较  
    动态比静态的应用要广泛的多:  
    - 动态结构简单，集成度远高于静态RAM.  
    - 动态RAM行列地址按先后顺序输送，减少了芯片引脚，封装尺寸也减少.  
    - 动态RAM的功耗比静态小.  
    - 动态RAM的价格更便宜.  
  
    动态RAM的缺点:  
    - 由于使用动态元件(电容)，因此速度比静态RAM低.  
    - 动态RAM需要配置再生电路，也需要消耗一部分功率.  

### 3.2.2 只读存储器

- 掩模ROM  
    行列交叉处固定MOS管，有即'1', 无即'0'.  
    在生产时就已固定状态，无法改变。

- PROM  
    一次性编程只读存储器。
    单元由双极型电路和熔丝构成，熔断为'0', 未熔断为'1', 熔丝断后无法恢复，只能一次编程，不能修改.  

- EPROM  
    可擦除可编程只读存储器.  
    ...  

### 3.2.3 存储器与CPU的连接

- 存储容量的扩展  
    - 位扩展: 略
    - 字扩展: 略
    - 字，位扩展: 略

- 存储器与CPU的连接  
    - 地址线  
        CPU的地址线数往往比存储芯片的地址线数多.  
        将CPU的低位与存储芯片地址线相连, 高位地址线用于扩充或片选等.  
    - 数据线  
        CPU的数据线数与存储芯片的数据线数也不一定相等.  
    - 读写命令线  
        通常高电平为读, 低电平为写. 有些CPU的读写命令线是分开的
    - 片选线  
        存储器由许多存储芯片组成, 哪一片被选中取决于该存储芯片的片选控制端 $\overline{CS}$ 是否有CPU的片选有效信号.  
    - 合理选择存储芯片  
        通常选用 ROM 存放系统程序, 标准子程序和各类常数等.  
        RAM则是为用户编程而设置的.  

### 3.2.4 存储器的校验

在计算机运行过程中, 由于种种原因致使数据在存储过程中可能出现差错.  
为了能及时发现错误并纠正, 通常会将原数据配成汉明码.  

[内存纠错科普](https://www.bilibili.com/video/BV1GF411V7sC)

- 汉明码的组成:  
    在代码的第 2^(k-1) (k = 1, 2, ...) 位上增加纠错码, 承担"奇偶检错"任务.  
    第 2^(k-1) 位负责检测 (2^(k-1) ~ 2^k-1) x (2n-1) (n = 1, 2, ...) 的数据.  

- 汉明码的纠错:  
    使用偶检验时, 将各位纠错码与其负责的数据位进行异或运算, 将结果组成一个二进制数, 靠后的为数的高位.  
    其代表的就是出错的数据的位置, 如果为0, 就表示没错.  
    如果是奇校验, 异或后取非(即同或运算), 其他步骤一致.  

### 3.2.5 提高访存速度

1. 单体多字系统:  
    程序与数据在存储体内是连续存放的, 因此 CPU 访存取出的信息也是了连续的, 如果可以单存取周期内一次取出4条指令, 逐条发给 CPU 执行, 可以显著提高存取速度.  

2. 多体并行系统:  
    多体即多个模块, 每个模块有独立的 MAR, MDR 等, 可以并行或交叉工作.  
    - 高位交叉编址的多体存储器:  
        体内地址连续存放(一个体存放满后, 再存入下一个体). 多个体可并行存储.  
        这种编制方式有利于扩充.  
    - 低位交叉编址的多体存储器:  
        程序连续存放在相邻体中. 体内的地址为等差数列, 差值即存储体的个数.  
    高位的在取连续地址时只有一个体在工作, 而低位的因为地址的下一位在相邻的下一个存储体中, 所以取连续的地址也需要多个体并行工作(效率高).  
    设存储器模块数为 n, 存取周期为 T, 总线传输周期为 t, 采用流水线方式存取时, 应满足 T = nt.  
    连续读取n个字: 低位所需时间: T+(n-1)t; 高位: nT.  

3. 高性能存储芯片:  
    DRAM(动态随机存储器), 广泛应用于主存. 其发展速度很快. 有SDRAM, RDRAM, CDRAM.  


## 3.3 高速缓冲存储器(Cache)

在CPU与主存之间加一级缓存, 缓解CPU与主存速度不匹配的问题, 避免CPU与I/O设备争抢访存. 

程序访问的局部性原理:  
由于指令和数据的在内存都是连续存放的, 并且有些指令和数据往往会被多次调用, 即指令和数据在主存的地址是相对簇聚的, 访存具有相对的局部性.  

工作原理:  
将 Cache 与主存分块, 它们的块大小相同.  
将一些主存块放入缓存块中. CPU 读主存的某字时, 如果已在缓存中, 可直接访问 Cache; 如果不在, 需先将对应得主存块调入 Cache.  

### 3.3.1 Cache-主存地址映射

由主存地址映射到 Cache 地址称为地址映射.  
映射方式: 直接映射(固定的映射关系), 权相联映射(灵活性大的映射关系), 组相联映射(前两种映射的折中).  

1. 直接映射:  
    每个主存块只与一个缓存块对应, 映射关系为:  
    i = j mod C 或 i = j mod 2^C  
    i 为缓存块号, j 为主存块号, C 为缓存块数.  

    这种方式实现简单, 只需要利用主存地址的某些位直接判断, 即可确定所需字块是否在缓存中.  
    每个主存块只能固定地对应某个缓存块, 缓存的存储空间得不到充分利用.  

2. 全相联映射:  
    全相联映射允许主存中每一字块映射到 Cache 的任何一块位置上.  
    这种方式成本较高, 地址的比较次数较多.  

3. 组相联映射:  
    将 Cache 分为 Q 组, 每组 R 块, i = j mod Q.  
    缓存的一个组中映射R个随机的主存块.  


###  3.3.2 替换策略

当新的主存块需要调入 Cache 并且它的可用空间位置又被占满，需要替换掉 Cache 的数据，因此产生替换策略(算法)问题.  

在直接映射的 Cache 中, 主存块与唯一缓存块有映射关系, 所有替换策略很简单.  而在组相联和全相联映射的 Cache 中, 主存块可以写入 Cache 中多个位置, 需要替换策略.  

1. 先进先出(First-In-First-Out, FIFO)算法:  
     FIFO 算法选择最早调入 Cache 的字块进行替换.  
2. 近期最少使用(Least Recently Used, LRU)算法:  
     LRU 算法比较好地利用访存局部性原理, 替换最近用得最少的字块. 需要记录 Cache 中各字块的使用情况.  
     这种方法比较复杂, 一般采用简化的方法, 只记录每个块最近一次使用的时间.  
3. 随机法:  
     随机地确定被替换的块, 比较简单, 但和 FIFO 一样无法提高 Cache 的命中率.  


## 3.4 辅助存储器*

又称外部存储器, 简称外存.  
与主存相比, 辅存具有容量大, 速度慢, 价格低, 可脱机保存信息等特点, 属于"非易失性"存储器.  
目前, 广泛使用的有 硬磁盘, 软磁盘, 磁带, 光盘等.  


磁表面存储器的主要技术指标:  
1. 记录密度:  
    为了避免干扰, 磁道之间保持一定距离, 相邻磁道的距离称为道距(P). 道密度: $D_t = \frac{1}{P}$ , 单位 tpi(道每英寸)或 tpm(道每毫米).  
    位密度或线密度(单位: bpi或bpm): 对于磁盘, $D_b = \frac{f}{πd_{min}}$. f 为每道总位数, d_min 为最小磁带直径.  

2. 存储容量  
3. 平均寻址时间
4. 数据传输效率
5. 误码率


[机械盘与固态盘](https://www.bilibili.com/video/BV1dE411k7tU)

光盘的介质互换性好, 存储容量大, 可用于文献档案, 图书管理, 多媒体等方面的应用. 但由于目前价格比较贵, 故尚不能替代磁带机.  
硬磁盘存储器容量大, 数据传输率比光盘高, 等待时间短. 作为主存的后备存储器.  
软磁盘存储器容量小, 数据传输率低, 平均寻道时间长, ... 近年来已逐渐被淘汰.  
磁带, 逐渐被磁盘取代.  



# 输入输出系统

## 4.1 概述

### 发展过程

1. 早期阶段:  
    I/O 设备比较少, I/O 设备与主存交换信息都必须经过 CPU.  
    - 每个 I/O 设备都必须配有一套独立的逻辑电路与 CPU 相连, 线路散乱庞杂.  
    - 输入输出过程穿插在 CPU 执行程序过程中, 需要 CPU 停止工作.  
    - 每个 I/O 设备的逻辑控制电路与 CPU 的控制器紧密相连, 变更十分困难.  

2. 接口模块和 MDA 阶段:  
    I/O 设备通过接口模块与主机连接, 计算机系统采用总线结构.  
    出现直接存储器存取(DMA)技术, I/O 设备与主存之间有一条直接数据通路.

3. 具有通道结构的阶段:  
    用通道来负责管理 I/O 设备之间交换信息的部件, 可以视为一种具有特殊功能的处理器.  

4. 具有 I/O 处理机的阶段:  
    I/O 处理机又称为外围处理机, 它独立于主机工作, 既可完成 I/O 通道的 I/O 控制, 又可完成码制变换, 格式处理, 数据块检错, 纠错等操作.  

主要介绍第二阶段的输入输出系统. 其后阶段的介绍在 "计算机体系结构" 课程.  


### 输入输出系统的组成

输入输出系统由 **I/O 软件**和 **I/O 硬件**组成.  

- I/O 软件  
    - I/O 指令: 是机器指令的一类.  
        一般格式:  | 操作码 | 命令码 | 设备码 |  
        操作码将其与其他指令区别开. 命令码为具体的操作. 设备码是对设备的选择.  
    - 通道指令: 通道自身的指令.  
        指出数据的首地址, 传送字数, 操作命令.  
        通道指令放在主存中.  
        由 CPU 执行启动 I/O 设备的指令, 由通道代替 CPU 对 I/O 设备进行管理.  

- I/O 硬件  
    一般包括接口模块及 I/O 设备.  
    主机 <-> I/O接口 <-> 设备控制器 <-> 设备


### I/O设备与主机信息传送的控制方式

1. 程序查询方式
    由 CPU 通过程序不断查询 I/O 设备是否已做好准备, 从而控制 I/O 设备与主机交换信息. 期间CPU会终止原程序的执行. 这种方式CPU的工作效率不高.  

2. 程序中断方式
    CPU 在启动 I/O 设备后, 继续执行自身程序. 当 I/O 设备准备就绪时, 向 CPU 发出中断请求, 得到响应.  

3. DMA 方式  
    主存与I/O设备之间有一条数据通路, 主存与I/O设备交换信息时, 无须调用中断服务程序, 即不会占用CPU. CPU 与 DMA 同时访问主存, CPU会让给DMA(称窃取或挪用).


## 4.2 I/O设备

中央处理器和主存构成了主机, 除主机外的大部分硬件设备都可称为 I/O 设备或外部设备, 或外围设备, 简称外设.  

I/O 设备的大致分类:  
1. 人机交互设备  
    如键盘, 鼠标, 手写板, 摄像机..., 打印机, 显示器...  
2. 计算机信息存储设备  
    即辅助存储器, 如磁盘, 固态盘...  
3. 机-机通信设备  
    如调制解调器, 数/模或模/数转换器..., 计算机网络.  


### 4.2.1 输入输出设备

- 键盘:  
    1. 按下一个键.  
    2. 查出按下的是哪个键.  
    3. 译成 ASCII 码, 由主机接收.  

- 鼠标:  
    常用的有机械式和光电式.  
    通过底部的传感器检测运动的方向和距离, 从而控制光标移动.  

- 显示器:  
    按显示器件分: 阴极射线管(CRT)显示器, 液晶显示器(LCD), 等离子显示器(PD)等.  
    按所显示的信息内容分为: 字符显示器, 图形显示器, 图像显示器.  
    
    指标:  
    - 屏幕大小: 按屏幕对角线长度表示.  
    - 分辨率: 像素个数, 以宽高的像素乘积表示.  
    - 灰度级: 像素点的亮暗或颜色差别, 8位(256级), 16位等.  
    - 刷新频率: 光点一般维持几十毫秒, 需要不断刷新, 一般在 60 ~ 120Hz.  
    - 显示存储器(VRAM): 为了不断刷新, 需要保存瞬时的图像信息, 又称刷新存储器, 帧存储器, 视频存储器. 其大小为: 分辨率 x 灰度级位数 (bit).  







